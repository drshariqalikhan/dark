<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IWQU Mobile Screener</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="data:application/manifest+json,{'name':'IWQU Screener','short_name':'IWQU','start_url':'.','display':'standalone','background_color':'#020617','theme_color':'#4f46e5'}">
    <style>
        :root { --bg-dark: #020617; --card-dark: #0f172a; --border-dark: #1e293b; --accent: #6366f1; --text-main: #f8fafc; --text-dim: #94a3b8; }
        body { background-color: var(--bg-dark); color: var(--text-main); min-height: 100vh; }
        .hero.is-dark { background-color: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-dark); }
        .card { background-color: var(--card-dark); border: 1px solid var(--border-dark); color: var(--text-main); border-radius: 12px; }
        .table thead th { color: var(--text-dim) !important; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.05em; border-bottom: 2px solid var(--border-dark); }
        .table td { border-bottom: 1px solid var(--border-dark); vertical-align: middle; font-size: 0.85rem; }
        .modal-card { background-color: var(--card-dark); border: 1px solid var(--border-dark); }
        .modal-card-head, .modal-card-foot { background-color: #020617; border-color: var(--border-dark); }
        .modal-card-title { color: var(--text-main); font-size: 1rem; }
        #log-container { height: 400px; overflow-y: auto; background: #020617; padding: 1rem; font-family: monospace; font-size: 0.75rem; }
        .log-entry { margin-bottom: 6px; border-bottom: 1px solid #1e293b; padding-bottom: 4px; }
        .log-time { color: #64748b; margin-right: 8px; }
        .log-info { color: #818cf8; }
        .log-success { color: #10b981; }
        .log-error { color: #f43f5e; }
        .tag.is-relative { background-color: #1e293b; color: #10b981; font-weight: bold; font-size: 0.7rem; }
        .table-container { overflow-x: auto; }
    </style>
</head>
<body>
    <section class="hero is-dark is-small"><div class="hero-body"><div class="container"><div class="level is-mobile"><div class="level-left"><div><h1 class="title is-5 has-text-white mb-0">IWQU Pro</h1><p class="subtitle is-7 has-text-grey-light">Mobile Screener</p></div></div><div class="level-right"><button id="toggle-logs" class="button is-dark is-small"><span class="icon"><i class="fas fa-list-ul"></i></span><span>LOGS</span></button></div></div></div></div></section>
    <div class="container px-3 py-4">
        <div class="card p-4"><div class="columns is-mobile is-vcentered"><div class="column"><label class="label is-small has-text-grey">Limit</label><input id="scan-limit" class="input is-small" type="number" value="100"></div><div class="column is-narrow pt-5"><button id="scan-btn" class="button is-info is-small px-5">SCAN</button></div></div><div id="progress-container" class="mt-3 is-hidden"><progress id="scan-progress" class="progress is-accent is-small" value="0" max="100"></progress></div></div>
        <div class="card p-0 mt-4"><div class="table-container"><table class="table is-fullwidth is-hoverable"><thead><tr><th>Symbol</th><th>Sector</th><th>Price</th><th>100W SMA</th><th>Rel. SPY</th><th>Dist %</th></tr></thead><tbody id="results-body"><tr><td colspan="6" class="has-text-centered py-6">Run scan...</td></tr></tbody></table></div></div>
    </div>
    <div id="logs-modal" class="modal"><div class="modal-background" id="modal-bg"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Logs</p><button class="delete" id="close-logs"></button></header><section class="modal-card-body p-0"><div id="log-container"></div></section><footer class="modal-card-foot"><button class="button is-small is-info" id="close-logs-btn">Close</button></footer></div></div>
    <script>
        const API_URL = 'https://iwqu-api.onrender.com/api/scan';
        const scanBtn = document.getElementById('scan-btn'), limitInput = document.getElementById('scan-limit'), resultsBody = document.getElementById('results-body'), logContainer = document.getElementById('log-container'), progressContainer = document.getElementById('progress-container'), progressBar = document.getElementById('scan-progress');
        const logsModal = document.getElementById('logs-modal'), toggleLogs = document.getElementById('toggle-logs'), closeLogs = document.getElementById('close-logs'), closeLogsBtn = document.getElementById('close-logs-btn'), modalBg = document.getElementById('modal-bg');
        function toggleModal() { logsModal.classList.toggle('is-active'); }
        toggleLogs.addEventListener('click', toggleModal); [closeLogs, closeLogsBtn, modalBg].forEach(el => el.addEventListener('click', toggleModal));
        function addLog(msg, type = 'info') { const entry = document.createElement('div'); entry.className = 'log-entry'; entry.innerHTML = `<span class="log-time">[${new Date().toLocaleTimeString()}]</span><span class="log-${type}">${msg}</span>`; logContainer.prepend(entry); }
        async function runScan() {
            const limit = limitInput.value; scanBtn.classList.add('is-loading'); resultsBody.innerHTML = ''; progressContainer.classList.remove('is-hidden'); progressBar.value = 20;
            try {
                const r = await fetch(`${API_URL}?limit=${limit}`); const j = await r.json(); const data = j.data || [];
                progressBar.value = 100;
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td><strong>${item.symbol}</strong></td><td class="is-size-7">${item.sector}</td><td>$${item.price.toFixed(2)}</td><td class="has-text-grey">$${item.sma100.toFixed(2)}</td><td><span class="tag is-relative">${item.relativeReturn.toFixed(2)}x</span></td><td class="${item.diffPercent < 0 ? 'has-text-success' : 'has-text-warning'}">${item.diffPercent.toFixed(1)}%</td>`;
                    resultsBody.appendChild(row);
                });
            } catch (err) { addLog(err.message, 'error'); } finally { scanBtn.classList.remove('is-loading'); }
        }
        scanBtn.addEventListener('click', runScan);
    </script>
</body>
</html>