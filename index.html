<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IWQU Mobile Screener</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="data:application/manifest+json,{'name':'IWQU Screener','short_name':'IWQU','start_url':'.','display':'standalone','background_color':'#020617','theme_color':'#4f46e5'}">
    <style>
        :root { --bg-dark: #020617; --card-dark: #0f172a; --border-dark: #1e293b; --accent: #6366f1; --text-main: #f8fafc; --text-dim: #94a3b8; }
        body { background-color: var(--bg-dark); color: var(--text-main); min-height: 100vh; }
        .hero.is-dark { background-color: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-dark); }
        .card { background-color: var(--card-dark); border: 1px solid var(--border-dark); color: var(--text-main); border-radius: 12px; }
        .input, .button.is-dark { background-color: #020617; border-color: var(--border-dark); color: var(--text-main); }
        .table { background-color: transparent; color: var(--text-main); }
        .table thead th { color: var(--text-dim) !important; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; border-bottom: 2px solid var(--border-dark); }
        .table td { border-bottom: 1px solid var(--border-dark); vertical-align: middle; }
        #log-window { height: 200px; overflow-y: auto; background: #020617; border: 1px solid var(--border-dark); border-radius: 8px; padding: 1rem; font-family: monospace; font-size: 0.8rem; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #1e293b; padding-bottom: 2px; }
        .log-time { color: #64748b; margin-right: 8px; }
        .log-info { color: #818cf8; }
        .log-success { color: #10b981; }
        .log-error { color: #f43f5e; }
        .progress.is-accent::-webkit-progress-value { background-color: var(--accent); }
        .tag.is-relative { background-color: #1e293b; color: #10b981; font-weight: bold; }
    </style>
</head>
<body>
    <section class="hero is-dark is-small"><div class="hero-body"><div class="container"><div class="level is-mobile"><div class="level-left"><div class="mr-4"><span class="icon is-large has-text-info"><i class="fas fa-chart-line fa-2x"></i></span></div><div><h1 class="title is-4 has-text-white mb-0">IWQU Pro</h1><p class="subtitle is-7 has-text-grey-light">Vanilla PWA v1.0</p></div></div></div></div></div></section>
    <div class="container px-4 py-6">
        <div class="columns is-multiline">
            <div class="column is-12"><div class="card p-5"><div class="columns is-mobile is-vcentered"><div class="column"><label class="label is-small has-text-grey">Scan Limit</label><input id="scan-limit" class="input is-small" type="number" value="100"></div><div class="column is-narrow pt-5"><button id="scan-btn" class="button is-info is-fullwidth px-6 has-text-weight-bold"><span class="icon"><i class="fas fa-rocket"></i></span><span>SCAN</span></button></div></div><div id="progress-container" class="mt-4 is-hidden"><div class="level is-mobile mb-2"><div class="level-left"><span id="status-text" class="is-size-7 has-text-grey">Ready</span></div></div><progress id="scan-progress" class="progress is-accent is-small" value="0" max="100"></progress></div></div></div>
            <div class="column is-12 is-8-desktop"><div class="card p-0" style="overflow-x: auto;"><table class="table is-fullwidth is-hoverable mb-0"><thead><tr><th>Symbol</th><th>Price</th><th>Rel. SPY</th><th>Dist %</th></tr></thead><tbody id="results-body"><tr><td colspan="4" class="has-text-centered py-6 has-text-grey"><i class="fas fa-search-dollar fa-3x mb-4 opacity-50"></i><p>Start a scan to see quality value picks</p></td></tr></tbody></table></div></div>
            <div class="column is-12 is-4-desktop"><div class="card p-4"><h3 class="title is-7 has-text-grey uppercase mb-3 tracking-widest">System Engine Logs</h3><div id="log-window"></div></div></div>
        </div>
    </div>
    <script>
        const API_URL = 'https://iwqu-api.onrender.com/api/scan';
        const scanBtn = document.getElementById('scan-btn'), limitInput = document.getElementById('scan-limit'), resultsBody = document.getElementById('results-body'), logWindow = document.getElementById('log-window'), progressContainer = document.getElementById('progress-container'), progressBar = document.getElementById('scan-progress'), statusText = document.getElementById('status-text');
        function addLog(msg, type = 'info') { const entry = document.createElement('div'); entry.className = 'log-entry'; entry.innerHTML = `<span class="log-time">[${new Date().toLocaleTimeString()}]</span><span class="log-${type}">${msg}</span>`; logWindow.prepend(entry); }
        async function runScan() {
            const limit = limitInput.value; scanBtn.classList.add('is-loading'); resultsBody.innerHTML = ''; progressContainer.classList.remove('is-hidden'); progressBar.value = 30; statusText.innerText = 'Connecting...';
            try {
                const r = await fetch(`${API_URL}?limit=${limit}`); if (!r.ok) throw new Error('API Error');
                const json = await r.json(); const data = json.data || [];
                progressBar.value = 100; statusText.innerText = `Found ${data.length} matches`;
                if (data.length === 0) resultsBody.innerHTML = '<tr><td colspan="4" class="has-text-centered py-6">No matches</td></tr>';
                else data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td><strong class="has-text-info">${item.symbol}</strong><br><small class="has-text-grey">${item.sector}</small></td><td>$${item.price.toFixed(2)}</td><td><span class="tag is-relative">${item.relativeReturn.toFixed(2)}x</span></td><td class="${item.diffPercent < 0 ? 'has-text-success' : 'has-text-warning'}">${item.diffPercent.toFixed(2)}%</td>`;
                    resultsBody.appendChild(row);
                });
            } catch (err) { addLog(err.message, 'error'); } finally { scanBtn.classList.remove('is-loading'); setTimeout(() => progressContainer.classList.add('is-hidden'), 3000); }
        }
        scanBtn.addEventListener('click', runScan);
        if ('serviceWorker' in navigator) { const sw = "self.addEventListener('fetch', e => e.respondWith(fetch(e.request)));"; navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw], {type: 'text/javascript'}))); }
    </script>
</body>
</html>